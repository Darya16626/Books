{% extends 'base.html' %}
{% block title %}–ê–¥–º–∏–Ω - –°–æ—Ü—Å–µ—Ç–∏{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="glass-card p-3">
                <h6><i class="fas fa-globe me-2"></i>–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã</h6>
                <div class="btn-group w-100">
                    <a href="{% url 'admin_social_page' %}" class="btn btn-outline-primary {% if not platform_filter %}active fw-bold{% endif %}">–í—Å–µ</a>
                    {% for platform, name in platforms %}
                    <a href="{% url 'admin_social_platform' platform %}" class="btn btn-outline-primary {% if platform_filter == platform %}active fw-bold{% endif %}">{{ name }}</a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- ‚úÖ –ì–õ–ê–í–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
    <div class="row g-4 mb-5">
        <div class="col-xl-3 col-md-6">
            <div class="stats-card text-white p-4 text-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <i class="fas fa-file-alt fa-2x mb-3"></i>
                <h2 class="fw-bold mb-1">{{ stats.total_posts }}</h2>
                <p class="mb-0">–í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤</p>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card text-white p-4 text-center" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <i class="fas fa-eye fa-2x mb-3"></i>
                <h2 class="fw-bold mb-1">{{ stats.published_posts }}</h2>
                <p class="mb-0">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ</p>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card text-white p-4 text-center" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <i class="fas fa-heart fa-2x mb-3"></i>
                <h2 class="fw-bold mb-1">{{ stats.total_likes|floatformat:0|default:0 }}</h2>
                <p class="mb-0">–õ–∞–π–∫–æ–≤</p>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="stats-card text-white p-4 text-center" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <i class="fas fa-eye fa-2x mb-3"></i>
                <h2 class="fw-bold mb-1">{{ stats.total_views|floatformat:0|default:0 }}</h2>
                <p class="mb-0">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
        <div class="col-lg-6">
            <div class="glass-card p-4 h-100">
                <h5 class="fw-bold mb-4"><i class="fas fa-users me-2"></i>–¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–ü–æ—Å—Ç–æ–≤</th>
                                <th>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                                <th>–õ–∞–π–∫–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for client in stats.client_stats %}
                            <tr>
                                <td><strong>{{ client.client__username }}</strong></td>
                                <td><span class="badge bg-primary">{{ client.posts_count|default:0 }}</span></td>
                                <td>{{ client.total_views|floatformat:0|default:0 }}</td>
                                <td>{{ client.total_likes|floatformat:0|default:0 }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4" class="text-center text-muted py-4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã -->
        <div class="col-lg-6">
            <div class="glass-card p-4 h-100">
                <h5 class="fw-bold mb-4"><i class="fas fa-user-tie me-2"></i>–¢–æ–ø –º–µ–Ω–µ–¥–∂–µ—Ä—ã</h5>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–ú–µ–Ω–µ–¥–∂–µ—Ä</th>
                                <th>–ü–æ—Å—Ç–æ–≤</th>
                                <th>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</th>
                                <th>–õ–∞–π–∫–∏</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for manager in stats.manager_stats %}
                            <tr>
                                <td><strong>{{ manager.manager__username }}</strong></td>
                                <td><span class="badge bg-success">{{ manager.posts_count|default:0 }}</span></td>
                                <td>{{ manager.total_views|floatformat:0|default:0 }}</td>
                                <td>{{ manager.total_likes|floatformat:0|default:0 }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="4" class="text-center text-muted py-4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞—Ö</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚úÖ –í–°–ï –ü–û–°–¢–´ - –ë–ï–ó –õ–ò–®–ù–ï–ô –ö–ù–û–ü–ö–ò -->
    <div class="glass-card p-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold mb-0">üì± –í—Å–µ –ø–æ—Å—Ç—ã ({{ all_posts|length }})</h3>
            <div>
                <span class="badge bg-warning me-2">‚≠ê {{ stats.reviews_stats.avg_rating|floatformat:1|default:"0" }}/5</span>
                <span class="badge bg-info">{{ stats.reviews_stats.total_reviews|default:"0" }} –æ—Ç–∑—ã–≤–æ–≤</span>
            </div>
        </div>
        <div class="row g-4">
            {% for post in all_posts %}
            <div class="col-xl-3 col-lg-4 col-md-6">
                <div class="glass-card p-4 h-100">
                    <!-- üî• –ö–ê–†–¢–ò–ù–ö–ê –ø–æ image_url -->
                    {% if post.image_url %}
                    <div class="post-image-wrapper mb-3 rounded-3 overflow-hidden">
                        <img src="{{ post.image_url }}" 
                             alt="{{ post.title|default:'–ü–æ—Å—Ç' }}" 
                             class="post-image w-100"
                             style="height: 140px; object-fit: cover;"
                             loading="lazy"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <!-- –ó–∞–≥–ª—É—à–∫–∞ -->
                        <div class="image-placeholder d-none d-flex align-items-center justify-content-center bg-light text-muted h-100">
                            <i class="fas fa-image fa-2x opacity-50"></i>
                        </div>
                    </div>
                    {% else %}
                    <div class="no-image-placeholder rounded-3 mb-3 d-flex align-items-center justify-content-center bg-light text-muted" style="height: 140px;">
                        <i class="fas fa-image fa-2x opacity-50"></i>
                    </div>
                    {% endif %}

                    <!-- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏ —Å—Ç–∞—Ç—É—Å -->
                    <div class="d-flex justify-content-between mb-3">
                        <span class="platform-badge {{ post.platform }}-badge fs-6">
                            <i class="fab fa-{{ post.platform }} me-1"></i>{{ post.get_platform_display }}
                        </span>
                        <span class="badge {% if post.is_published %}bg-success{% else %}bg-warning{% endif %} fs-6">
                            {% if post.is_published %}–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ{% else %}–ß–µ—Ä–Ω–æ–≤–∏–∫{% endif %}
                        </span>
                    </div>

                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                    <h6 class="fw-semibold mb-2">{{ post.title|truncatechars:40 }}</h6>
                    <p class="text-muted small mb-3">{{ post.content|truncatewords:15 }}</p>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <small class="text-muted">{{ post.client.username }} / {{ post.manager.username }}</small>
                        <div class="d-flex gap-1">
                            <span class="badge bg-primary fs-6"><i class="fas fa-eye"></i> {{ post.views|default:0 }}</span>
                            <span class="badge bg-success fs-6"><i class="fas fa-heart"></i> {{ post.likes|default:0 }}</span>
                        </div>
                    </div>

                    <!-- ‚úÖ –¢–û–õ–¨–ö–û –î–ê–¢–ê - –ë–ï–ó –ö–ù–û–ü–û–ö -->
                    <div class="text-center pb-2">
                        <small class="text-muted">{{ post.created_at|date:"d.m H:i" }}</small>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="fas fa-inbox fa-4x text-muted mb-4"></i>
                <h5 class="text-muted">–ü–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h5>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.glass-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    transition: all 0.3s ease;
}
.glass-card:hover { 
    transform: translateY(-5px); 
    box-shadow: 0 25px 50px rgba(0,0,0,0.15) !important; 
}

.post-image-wrapper {
    height: 140px !important;
    position: relative;
    border-radius: 12px !important;
    overflow: hidden;
    background: #f8f9fa;
}

.post-image {
    width: 100% !important;
    height: 140px !important;
    object-fit: cover !important;
    transition: transform 0.4s ease !important;
}

.post-image:hover {
    transform: scale(1.05) !important;
}

.image-placeholder, .no-image-placeholder {
    height: 140px !important;
    transition: all 0.3s ease;
}

.platform-badge {
    padding: 6px 12px;
    border-radius: 25px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}
.vk-badge { background: linear-gradient(135deg, #4680C2, #4C75A3); color: white; }
.telegram-badge { background: linear-gradient(135deg, #0088CC, #229ED9); color: white; }
.instagram-badge { background: linear-gradient(135deg, #E4405F, #F77737); color: white; }
.youtube-badge { background: linear-gradient(135deg, #FF0000, #CC0000); color: white; }

.stats-card { 
    transition: all 0.3s ease; 
    border-radius: 16px; 
}
.stats-card:hover { 
    transform: scale(1.05) translateY(-3px); 
}
</style>
{% endblock %}
