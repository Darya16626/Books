{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–Ω–∏–≥–∏ - BookHaven</title>

<!-- Google Fonts —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã -->
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Lobster&family=Orbitron&family=Pacifico&family=Russo+One&family=Vampiro+One&display=swap&subset=cyrillic" rel="stylesheet" />

<link rel="stylesheet" href="{% static 'css/style.css' %}" />
<style>
:root {
    /* –¶–≤–µ—Ç–∞ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ–ø–∏—è –∞–¥–º–∏–Ω—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    --color-accent: #0066cc;
    --color-bg-light: #e6f0ff; /* —Å–≤–µ—Ç–ª—ã–π –∫–æ—Å–º–æ—Å —Å –ª–µ–≥–∫–∏–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º */
    --color-bg-dark: #1a162b; /* —Ç—ë–º–Ω—ã–π –∫–æ—Å–º–æ—Å */
    --color-text-light: #222222;
    --color-text-dark: #eaeaea;
    --color-button-text: #ffffff;

    --font-family: 'Cinzel Decorative', serif;

    --border-radius: 10px;
    --btn-padding: 12px 25px;
    --btn-font-size: 1rem;
    --btn-shadow: 0 5px 15px rgba(0, 102, 204, 0.25);
    --card-shadow-light: 0 10px 40px rgba(0, 102, 255, 0.2);
    --card-shadow-dark: 0 10px 30px rgba(0,0,0,0.6);
}

/* –¢–µ–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–≤–µ—Ç–ª–∞—è */
body:not(.dark-theme) {
    --color-bg: linear-gradient(135deg, #e6f0ff 0%, #cce0ff 50%, #a3cfff 100%);
    --color-text: var(--color-text-light);
    --btn-shadow: 0 5px 15px rgba(0,102,255,0.4);
    --card-shadow: var(--card-shadow-light);
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body.dark-theme {
    --color-bg: var(--color-bg-dark);
    --color-text: var(--color-text-dark);
    --btn-shadow: 0 5px 15px rgba(0,66,134,0.7);
    --card-shadow: var(--card-shadow-dark);
}

body {
    margin: 30px 20px 50px;
    font-family: var(--font-family);
    background: var(--color-bg);
    background-repeat: no-repeat;
    background-attachment: fixed;
    color: var(--color-text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    overflow-x: hidden;
    transition: background-color 0.8s ease, color 0.4s ease;
}

/* Canvas –∏ SVG –¥–ª—è –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ —Ñ–æ–Ω–∞ */
#star-canvas, #constellation-svg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    user-select: none;
    z-index: 0;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–π */
.detail-container {
    max-width: 960px;
    width: 95%;
    background: rgba(255 255 255 / 0.85);
    border-radius: var(--border-radius);
    box-shadow: var(--card-shadow);
    padding: 30px 35px;
    display: flex;
    flex-direction: column;
    gap: 30px;
    position: relative;
    z-index: 10;
    transition: background-color 0.4s, box-shadow 0.4s, color 0.4s;
}
body.dark-theme .detail-container {
    background: rgba(30 30 47 / 0.85);
    box-shadow: var(--card-shadow);
    color: var(--color-text-dark);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∞–≤—Ç–æ—Ä */
.title {
    font-size: 3rem;
    font-weight: 900;
    text-align: center;
    color: var(--color-accent);
    font-family: 'Lobster', cursive;
    margin: 0 0 10px;
    text-shadow: 1px 1px 6px rgba(0,102,204,0.75);
}
.author {
    font-size: 1.25rem;
    color: #555;
    font-style: italic;
    text-align: center;
    margin-bottom: 25px;
    font-family: 'Russo One', sans-serif;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ */
.info-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    align-items: start;
}
@media (max-width: 720px) {
    .info-columns {
        grid-template-columns: 1fr;
        gap: 25px;
    }
}

/* –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.info-left {
    display: flex;
    flex-direction: column;
    align-items: center;
}
.main-image {
    width: 100%;
    max-height: 480px;
    border-radius: var(--border-radius);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
    object-fit: contain;
    background: #fff;
    transition: background-color 0.4s;
    cursor: zoom-in;
}
body.dark-theme .main-image {
    background: #3a3a57;
}
/* –ú–∏–Ω–∏–∞—Ç—é—Ä—ã */
.thumbnails {
    margin-top: 18px;
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    justify-content: center;
}
.thumbnail {
    width: 85px;
    height: 110px;
    border-radius: 8px;
    object-fit: cover;
    cursor: pointer;
    border: 3px solid transparent;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
    transition: border-color 0.3s ease, transform 0.25s ease;
}
.thumbnail:hover {
    transform: scale(1.05);
}
.thumbnail.active {
    border-color: var(--color-accent);
}

/* –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è */
.info-right {
    font-family: 'Russo One', sans-serif;
    font-size: 1.1rem;
    line-height: 1.6;
    color: var(--color-text-light);
}
body.dark-theme .info-right {
    color: var(--color-text-dark);
}
.info-right p {
    margin: 10px 0;
    font-weight: 500;
}
.info-right strong {
    color: var(--color-accent);
}

/* –ö–Ω–æ–ø–∫–∏ */
.buttons {
    margin-top: 35px;
    display: flex;
    justify-content: center;
}
.buttons a {
    text-decoration: none;
    background-color: var(--color-accent);
    padding: var(--btn-padding);
    border-radius: var(--border-radius);
    color: var(--color-button-text);
    font-weight: 700;
    font-size: var(--btn-font-size);
    box-shadow: var(--btn-shadow);
    transition: background-color 0.35s ease;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-family: var(--font-family);
}
.buttons a:hover,
.buttons a:focus {
    background-color: #004d99;
    outline: none;
}

/* –û–ø–∏—Å–∞–Ω–∏–µ */
.description {
    margin-top: 30px;
    font-size: 1.1rem;
    color: #444;
    white-space: pre-line;
    font-family: var(--font-family);
    line-height: 1.6;
}
body.dark-theme .description {
    color: var(--color-text-dark);
}

/* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –≤–≤–µ—Ä—Ö—É */
.theme-toggle {
    position: fixed;
    top: 22px;
    right: 22px;
    background: var(--color-accent);
    border: none;
    color: var(--color-button-text);
    padding: var(--btn-padding);
    border-radius: 30px;
    cursor: pointer;
    font-weight: 700;
    font-size: var(--btn-font-size);
    box-shadow: var(--btn-shadow);
    transition: background-color 0.3s ease;
    z-index: 1000;
    font-family: var(--font-family);
}
.theme-toggle:hover,
.theme-toggle:focus {
    background-color: #004d99;
    outline: none;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –æ—Ç–∑—ã–≤–æ–≤ */
section#reviews-section {
    max-width: 960px;
    width: 95%;
    margin: 40px auto 70px;
    font-family: 'Russo One', sans-serif;
}
section#reviews-section h2 {
    font-size: 2rem;
    font-weight: 800;
    color: var(--color-accent);
    text-align: center;
    margin-bottom: 25px;
}

.reviews-list {
    display: flex;
    flex-direction: column;
    gap: 22px;
}

.review {
    background: rgba(245 245 245 / 0.9);
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.07);
    padding: 20px 25px;
    transition: background-color 0.4s ease;
}
body.dark-theme .review {
    background: rgba(40 40 60 / 0.85);
    color: var(--color-text-dark);
}
.review p {
    margin: 6px 0;
    font-size: 1rem;
}
.review strong {
    color: var(--color-accent);
}

/* –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
.admin-response {
    background-color: rgba(0, 102, 204, 0.1);
    border-left: 4px solid var(--color-accent);
    padding-left: 15px;
    margin-top: 15px;
    font-style: italic;
    color: #004d99;
    border-radius: 4px;
}

/* –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞, –ª–∞–π–∫–∏ –∏ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è */
.review form {
    margin-top: 12px;
}
.review form textarea {
    width: 100%;
    border-radius: 8px;
    border: 1px solid #bbb;
    padding: 8px 12px;
    font-family: var(--font-family);
    font-size: 1rem;
    resize: vertical;
    transition: border-color 0.3s ease;
}
.review form textarea:focus {
    border-color: var(--color-accent);
    outline: none;
}
.review form button {
    margin-top: 8px;
    background-color: var(--color-accent);
    color: var(--color-button-text);
    border: none;
    padding: 10px 26px;
    font-size: 1rem;
    font-weight: 700;
    border-radius: var(--border-radius);
    cursor: pointer;
    box-shadow: var(--btn-shadow);
    transition: background-color 0.3s ease;
    font-family: var(--font-family);
}
.review form button:hover,
.review form button:focus {
    background-color: #004d99;
    outline: none;
}
/* Inline —Ñ–æ—Ä–º—ã –ª–∞–π–∫–æ–≤/–¥–∏–∑–ª–∞–π–∫–æ–≤ –∏ —É–¥–∞–ª–µ–Ω–∏—è */
.review form[style*="display:inline;"] button {
    background: var(--color-accent);
    margin: 0 6px 10px 0;
    padding: 6px 14px;
    font-weight: 700;
    font-size: 1rem;
    border-radius: 8px;
}
.review form[style*="display:inline;"] button:hover {
    background-color: #004d99;
}

/* –§–æ–∫—É—Å–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
a:focus,
button:focus {
    outline: 3px solid var(--color-accent);
    outline-offset: 2px;
}
</style>

<script>
// –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Ñ–æ–Ω —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∑–≤–µ–∑–¥ –∏ –∫–æ–º–µ—Ç - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ –∞–¥–º–∏–Ω—Å–∫–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    const canvas = document.createElement('canvas');
    canvas.id = 'star-canvas';
    document.body.appendChild(canvas);

    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.id = 'constellation-svg';
    svg.setAttribute('aria-hidden', 'true');
    svg.setAttribute('focusable', 'false');
    document.body.appendChild(svg);

    const ctx = canvas.getContext('2d');
    let width, height;

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width * devicePixelRatio;
        canvas.height = height * devicePixelRatio;
        canvas.style.width = width + 'px';
        canvas.style.height = height + 'px';
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.scale(devicePixelRatio, devicePixelRatio);
    }
    resize();
    window.addEventListener('resize', () => {
        resize();
        createConstellation();
    });

    function isDarkTheme() {
        return document.body.classList.contains('dark-theme');
    }

    class Star {
        constructor() {
            this.reset();
        }
        reset() {
            this.x = Math.random() * width;
            this.y = Math.random() * height;
            this.radius = (Math.random() * 1.2 + 0.4) * (isDarkTheme() ? 1 : 1.6);
            this.alpha = Math.random() * 0.8 + 0.4;
            this.dAlpha = (Math.random() * 0.007 + 0.002) * (Math.random() < 0.5 ? 1 : -1);
            this.speedX = (Math.random() - 0.5) * 0.06;
            this.speedY = (Math.random() - 0.5) * 0.06;
        }
        update() {
            this.alpha += this.dAlpha;
            if (this.alpha <= (isDarkTheme() ? 0.3 : 0.5) || this.alpha >= 1) this.dAlpha = -this.dAlpha;
            this.x += this.speedX;
            this.y += this.speedY;
            if (this.x < 0) this.x = width;
            if (this.x > width) this.x = 0;
            if (this.y < 0) this.y = height;
            if (this.y > height) this.y = 0;
        }
        draw() {
            ctx.beginPath();
            ctx.fillStyle = isDarkTheme()
                ? `rgba(255, 255, 255, ${this.alpha})`
                : `rgba(30, 115, 255, ${this.alpha * 0.9})`;
            ctx.shadowColor = isDarkTheme()
                ? 'rgba(255,255,255,0.7)'
                : 'rgba(100,170,255,0.8)';
            ctx.shadowBlur = isDarkTheme() ? 4 : 10;
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    class Comet {
        constructor() {
            this.reset();
        }
        reset() {
            this.x = Math.random() * width;
            this.y = Math.random() * height * 0.5;
            this.length = 80 + Math.random() * 40;
            this.speedX = 4 + Math.random() * 3;
            this.speedY = -0.5 + Math.random();
            this.radius = (1.5 + Math.random()) * (isDarkTheme() ? 1 : 1.4);
            this.tailLength = this.length * 1.5;
            this.tailWidth = this.radius * 4;
            this.alpha = 0.85 + Math.random() * 0.15;
        }
        update() {
            this.x += this.speedX;
            this.y += this.speedY;
            if (this.x - this.tailLength > width || this.y + this.tailLength < 0 || this.y - this.tailLength > height) {
                this.reset();
                this.x = -this.tailLength;
            }
        }
        draw() {
            const gradient = ctx.createLinearGradient(this.x, this.y, this.x - this.tailLength, this.y - this.tailLength*0.5);
            gradient.addColorStop(0, isDarkTheme()
                ? `rgba(255,255,255,${this.alpha})`
                : `rgba(100,170,255,${this.alpha * 0.9})`);
            gradient.addColorStop(1, 'rgba(255,255,255,0)');
            ctx.beginPath();
            ctx.fillStyle = gradient;
            ctx.shadowColor = isDarkTheme()
                ? 'rgba(255,255,255,0.9)'
                : 'rgba(100,170,255,0.7)';
            ctx.shadowBlur = isDarkTheme() ? 10 : 15;
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x - this.tailLength, this.y - this.tailLength*0.5);
            ctx.lineTo(this.x - this.tailLength + this.tailWidth, this.y - this.tailLength*0.5 + this.tailWidth*0.5);
            ctx.closePath();
            ctx.fill();
            ctx.shadowBlur = 0;

            ctx.beginPath();
            ctx.fillStyle = isDarkTheme()
                ? `rgba(255,255,255,${this.alpha})`
                : `rgba(100,170,255,${this.alpha})`;
            ctx.shadowColor = isDarkTheme()
                ? 'rgba(255,255,255,1)'
                : 'rgba(100,170,255,1)';
            ctx.shadowBlur = isDarkTheme() ? 15 : 20;
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }
    }

    const stars = [];
    const TOTAL_STARS = 180;
    for(let i = 0; i < TOTAL_STARS; i++) stars.push(new Star());

    const comets = [];
    const TOTAL_COMETS = 3;
    for(let i = 0; i < TOTAL_COMETS; i++) comets.push(new Comet());

    // –°–æ–∑–≤–µ–∑–¥–∏—è
    let constellationPoints = [];
    let constellationLines = [];

    // –ü–æ–¥–æ–±–Ω–æ –∞–¥–º–∏–Ω–∫–µ —Å–æ–∑–¥–∞—ë–º —Ç–æ—á–∫–∏ –∏ –ª–∏–Ω–∏–∏
    function initConstellationPoints() {
        constellationPoints = [
            {x: 0.2 * width, y: 0.2 * height},
            {x: 0.4 * width, y: 0.25 * height},
            {x: 0.6 * width, y: 0.15 * height},
            {x: 0.75 * width, y: 0.35 * height},
            {x: 0.85 * width, y: 0.2 * height},

            {x: 0.3 * width, y: 0.7 * height},
            {x: 0.5 * width, y: 0.8 * height},
            {x: 0.7 * width, y: 0.75 * height},
            {x: 0.9 * width, y: 0.85 * height}
        ];

        constellationLines = [
            [0, 1], [1, 2], [2, 4],
            [0, 3], [3, 4],
            [5, 6], [6, 7], [7, 8]
        ];
    }

    function createConstellation() {
        initConstellationPoints();
        svg.innerHTML = '';

        constellationPoints.forEach((point, i) => {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', point.x);
            circle.setAttribute('cy', point.y);
            circle.setAttribute('r', isDarkTheme() ? 4 : 6);
            circle.setAttribute('fill', isDarkTheme() ? 'lightpink' : '#4aa1ff');
            circle.style.filter = isDarkTheme() ? 'drop-shadow(0 0 4px #ffa6ba)' : 'drop-shadow(0 0 6px #5fb0ff)';
            circle.classList.add('const-star');
            svg.appendChild(circle);
        });

        constellationLines.forEach(line => {
            const [startIdx, endIdx] = line;
            const start = constellationPoints[startIdx];
            const end = constellationPoints[endIdx];
            const polyline = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
            polyline.setAttribute('points', `${start.x},${start.y} ${end.x},${end.y}`);
            polyline.setAttribute('stroke', isDarkTheme() ? 'lightpink' : '#4aa1ff');
            polyline.setAttribute('stroke-width', isDarkTheme() ? 2 : 3);
            polyline.setAttribute('fill', 'none');
            polyline.style.filter = isDarkTheme() ? 'drop-shadow(0 0 4px #ffa6ba)' : 'drop-shadow(0 0 6px #5fb0ff)';
            svg.appendChild(polyline);
        });
    }
    createConstellation();

    let constellationOffset = {x: 0, y: 0};
    let direction = 1;

    function animate() {
        ctx.clearRect(0, 0, width, height);
        stars.forEach(star => { star.update(); star.draw(); });
        comets.forEach(comet => { comet.update(); comet.draw(); });

        constellationOffset.x += 0.02 * direction;
        if (Math.abs(constellationOffset.x) > 10) direction *= -1;
        svg.style.transform = `translate(${constellationOffset.x}px, ${Math.sin(constellationOffset.x * 0.3) * 5}px)`;

        svg.querySelectorAll('circle').forEach((circle, i) => {
            let baseAlpha = 0.7 + 0.3 * Math.sin(Date.now() / 1000 + i);
            circle.style.opacity = baseAlpha.toFixed(2);
        });
        svg.querySelectorAll('polyline').forEach((pline, i) => {
            let baseAlpha = 0.5 + 0.4 * Math.sin(Date.now() / 1500 + i);
            pline.style.opacity = baseAlpha.toFixed(2);
        });

        requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const themeToggleBtn = document.createElement('button');
    themeToggleBtn.id = 'theme-toggle-btn';
    themeToggleBtn.className = 'theme-toggle';
    themeToggleBtn.type = 'button';
    themeToggleBtn.setAttribute('aria-pressed', 'false');
    themeToggleBtn.setAttribute('aria-label', '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç—ë–º–Ω—É—é –∏–ª–∏ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É');
    themeToggleBtn.textContent = '–¢—ë–º–Ω–∞—è / –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
    document.body.appendChild(themeToggleBtn);

    function applyThemeFromStorage() {
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
        }
        createConstellation();
        stars.forEach(star => star.reset());
        comets.forEach(comet => comet.reset());
    }
    applyThemeFromStorage();

    themeToggleBtn.addEventListener('click', () => {
        if (document.body.classList.contains('dark-theme')) {
            document.body.classList.remove('dark-theme');
            localStorage.setItem('theme', 'light');
        } else {
            document.body.classList.add('dark-theme');
            localStorage.setItem('theme', 'dark');
        }
        createConstellation();
        stars.forEach(star => star.reset());
        comets.forEach(comet => comet.reset());
    });
});
</script>

</head>
<body>

<div class="detail-container" role="main" aria-label="–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–Ω–∏–≥–∏">
    <h1 class="title">{{ book.title }}</h1>
    <p class="author" aria-label="–ê–≤—Ç–æ—Ä –∫–Ω–∏–≥–∏">–ê–≤—Ç–æ—Ä: {{ book.author }}</p>

    <div class="info-columns">
        <div class="info-left" aria-label="–û–±–ª–æ–∂–∫–∞ –∏ –≥–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–Ω–∏–≥–∏">
            {% with book.get_image_list|first as main_img %}
            {% if main_img %}
                <img id="mainImage" src="{{ main_img }}" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ {{ book.title }}" class="main-image" />
            {% else %}
                <div role="img" aria-label="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
                    style="width:100%; height:480px; background:#f0f0f0; border-radius: var(--border-radius); display:flex;align-items:center;justify-content:center; color:#aaa; font-size:1.1rem;">
                    –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                </div>
            {% endif %}
            {% endwith %}

            {% if book.get_image_list %}
            <div class="thumbnails" id="thumbnails" aria-label="–ú–∏–Ω–∏–∞—Ç—é—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∫–Ω–∏–≥–∏">
                {% for img_url in book.get_image_list %}
                <img src="{{ img_url }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ {{ book.title }} {{ forloop.counter }}"
                    class="thumbnail {% if forloop.first %}active{% endif %}" data-full="{{ img_url }}" />
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <div class="info-right" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ">
            <p><strong>–ñ–∞–Ω—Ä:</strong> {{ book.genre }}</p>
            <p><strong>–ì–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ book.year_created|default:"–Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
            <p><strong>–Ø–∑—ã–∫:</strong> {{ book.language|default:"–Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
            <p><strong>ISBN:</strong> {{ book.isbn }}</p>
            <p><strong>–ê—Ä—Ç–∏–∫—É–ª:</strong> {{ book.sku }}</p>
            <p><strong>–¶–µ–Ω–∞:</strong>
                {% if book.original_price and book.original_price != book.price %}
                <del>{{ book.original_price }} ‚ÇΩ</del> <strong>{{ book.price }} ‚ÇΩ</strong>
                {% else %}
                {{ book.price }} ‚ÇΩ
                {% endif %}
            </p>
            <p><strong>–í –Ω–∞–ª–∏—á–∏–∏:</strong> {{ book.stock_quantity }} —à—Ç.</p>
            <p><strong>–î–Ω–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ book.delivery_days }}</p>
            <p><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> {{ book.rating|floatformat:1 }}</p>

            <div class="buttons">
                <a href="{% url 'book_catalog' %}" role="button" aria-label="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É –∫–Ω–∏–≥">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É</a>
            </div>

            <div class="description" aria-label="–û–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏">
                <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>{{ book.description|linebreaks }}
            </div>
        </div>
    </div>
</div>

<section aria-labelledby="reviews-section">
    <h2 id="reviews-section">–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>

    {% if reviews %}
        <div class="reviews-list" role="list">
            {% for review in reviews %}
                <article class="review" aria-label="–û—Ç–∑—ã–≤ –æ—Ç {{ review.user.get_full_name }}" role="listitem">
                    <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> {{ review.user.get_full_name }}</p>
                    <p><strong>–û—Ü–µ–Ω–∫–∞:</strong> {{ review.rating }} / 5</p>
                    <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong><br>{{ review.comment|linebreaksbr }}</p>
                    <p><small>–î–∞—Ç–∞: {{ review.created_at|date:"d.m.Y H:i" }}</small></p>

                    {% if review.admin_response %}
                        <div class="admin-response" aria-label="–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
                            <strong>–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</strong>
                            <p>{{ review.admin_response|linebreaksbr }}</p>
                        </div>
                    {% endif %}

                    <form method="post" style="margin-top:10px;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="admin_respond" />
                        <input type="hidden" name="review_id" value="{{ review.id }}" />
                        <label for="response-{{ review.id }}">–û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∞:</label><br>
                        <textarea id="response-{{ review.id }}" name="response" rows="3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç...">{{ review.admin_response }}</textarea><br>
                        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
                    </form>

                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="react" />
                        <input type="hidden" name="review_id" value="{{ review.id }}" />
                        <button type="submit" name="is_like" value="true" title="–ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫" aria-label="–ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫">üëç {{ review.likes }}</button>
                    </form>
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="react" />
                        <input type="hidden" name="review_id" value="{{ review.id }}" />
                        <button type="submit" name="is_like" value="false" title="–ü–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∏–∑–ª–∞–π–∫" aria-label="–ü–æ—Å—Ç–∞–≤–∏—Ç—å –¥–∏–∑–ª–∞–π–∫">üëé {{ review.dislikes }}</button>
                    </form>

                    <form method="post" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–∑—ã–≤?');">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete_review" />
                        <input type="hidden" name="review_id" value="{{ review.id }}" />
                        <button type="submit" title="–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤" aria-label="–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </article>
            {% endfor %}
        </div>
    {% else %}
        <p>–ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤.</p>
    {% endif %}
</section>

<script>
// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –º–∏–Ω–∏–∞—Ç—é—Ä
document.addEventListener('DOMContentLoaded', () => {
    const thumbnails = document.getElementById('thumbnails');
    const mainImage = document.getElementById('mainImage');
    if(!thumbnails || !mainImage) return;

    thumbnails.addEventListener('click', (event) => {
        const target = event.target;
        if(target.tagName === 'IMG' && target.classList.contains('thumbnail')) {
            mainImage.src = target.getAttribute('data-full');
            thumbnails.querySelectorAll('img.thumbnail').forEach(img => img.classList.remove('active'));
            target.classList.add('active');
        }
    });
});
</script>

</body>
</html>
